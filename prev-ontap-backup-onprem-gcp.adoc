---
sidebar: sidebar 
permalink: prev-ontap-backup-onprem-gcp.html 
keywords: backing up, back up, backup, backup application data, Amazon Web services, AWS, NetApp Backup and Recovery, Oracle database, Microsoft SQL Server database, SAP HANA database 
summary: Proteggi i tuoi carichi di lavoro VMware con NetApp NetApp Backup and Recovery. 
---
= Esegui il backup dei dati ONTAP locali su Google Cloud Storage con NetApp Backup and Recovery
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Completa alcuni passaggi in NetApp Backup and Recovery per iniziare a eseguire il backup dei dati del volume dai tuoi sistemi ONTAP primari locali a un sistema di storage secondario e a Google Cloud Storage.


NOTE: I "sistemi ONTAP on-premises" includono i sistemi FAS, AFF e ONTAP Select .

[]
====
*NOTA* Per passare da e verso i carichi di lavoro NetApp Backup and Recovery, fare riferimento alink:br-start-switch-ui.html["Passa a diversi carichi di lavoro di backup e ripristino NetApp"] .

====


== Identificare il metodo di connessione

Scegli quale dei due metodi di connessione utilizzerai quando configuri i backup dai sistemi ONTAP locali a Google Cloud Storage.

* *Connessione pubblica* - Collega direttamente il sistema ONTAP a Google Cloud Storage tramite un endpoint pubblico di Google.
* *Connessione privata*: utilizza una VPN o Google Cloud Interconnect e instrada il traffico tramite un'interfaccia Google Access privata che utilizza un indirizzo IP privato.


Facoltativamente, è possibile connettersi a un sistema ONTAP secondario per i volumi replicati utilizzando anche la connessione pubblica o privata.

Il diagramma seguente mostra il metodo di *connessione pubblica* e le connessioni che è necessario preparare tra i componenti. L'agente della console deve essere distribuito nella VPC di Google Cloud Platform.

image:diagram_cloud_backup_onprem_gcp_public.png["Un diagramma che mostra come NetApp Backup and Recovery comunica tramite una connessione pubblica con i volumi sul cluster e lo storage Google Cloud in cui si trovano i file di backup."]

Il diagramma seguente mostra il metodo di *connessione privata* e le connessioni che è necessario preparare tra i componenti. L'agente della console deve essere distribuito nella VPC di Google Cloud Platform.

image:diagram_cloud_backup_onprem_gcp_private.png["Un diagramma che mostra come NetApp Backup and Recovery comunica tramite una connessione privata con i volumi sul cluster e lo storage Google Cloud in cui si trovano i file di backup."]



== Prepara il tuo agente Console

L'agente Console è il software principale per la funzionalità Console.  Per eseguire il backup e il ripristino dei dati ONTAP è necessario un agente Console.



=== Crea o cambia agenti della console

Se hai già un agente Console distribuito nella tua VPC di Google Cloud Platform, sei a posto.

In caso contrario, sarà necessario creare un agente Console in quella posizione per eseguire il backup dei dati ONTAP su Google Cloud Storage.  Non è possibile utilizzare un agente Console distribuito in un altro provider cloud o in locale.

* https://docs.netapp.com/us-en/console-setup-admin/concept-connectors.html["Scopri di più sugli agenti della console"^]
* https://docs.netapp.com/us-en/console-setup-admin/task-quick-start-connector-google.html["Installa un agente Console in GCP"^]




== Preparare la rete per l'agente della console

Assicurarsi che l'agente della console disponga delle connessioni di rete richieste.

.Passi
. Assicurarsi che la rete in cui è installato l'agente Console consenta le seguenti connessioni:
+
** Una connessione HTTPS sulla porta 443 a NetApp Backup and Recovery e al tuo spazio di archiviazione Google Cloud(https://docs.netapp.com/us-en/console-setup-admin/task-set-up-networking-google.html#endpoints-contacted-for-day-to-day-operations["vedere l'elenco degli endpoint"^] )
** Una connessione HTTPS sulla porta 443 al LIF di gestione del cluster ONTAP


. Abilitare Private Google Access (o Private Service Connect) sulla subnet in cui si prevede di distribuire l'agente Console. https://cloud.google.com/vpc/docs/configure-private-google-access["Accesso privato a Google"^] O https://cloud.google.com/vpc/docs/configure-private-service-connect-apis#on-premises["Connessione al servizio privato"^] sono necessari se si dispone di una connessione diretta dal cluster ONTAP alla VPC e si desidera che la comunicazione tra l'agente della console e Google Cloud Storage rimanga nella rete privata virtuale (una connessione *privata*).
+
Segui le istruzioni di Google per impostare queste opzioni di accesso privato.  Assicurati che i tuoi server DNS siano stati configurati per puntare `www.googleapis.com` E `storage.googleapis.com` agli indirizzi IP interni (privati) corretti.





=== Verificare o aggiungere autorizzazioni all'agente della console

Per utilizzare la funzionalità "Cerca e ripristina" NetApp Backup and Recovery, è necessario disporre di autorizzazioni specifiche nel ruolo per l'agente della console, in modo che possa accedere al servizio Google Cloud BigQuery.  Esaminare le autorizzazioni riportate di seguito e seguire i passaggi se è necessario modificare la policy.

.Passi
. Nel https://console.cloud.google.com["Google Cloud Console"^] , vai alla pagina *Ruoli*.
. Utilizzando l'elenco a discesa nella parte superiore della pagina, seleziona il progetto o l'organizzazione che contiene il ruolo che desideri modificare.
. Seleziona un ruolo personalizzato.
. Selezionare *Modifica ruolo* per aggiornare le autorizzazioni del ruolo.
. Selezionare *Aggiungi autorizzazioni* per aggiungere le seguenti nuove autorizzazioni al ruolo.
+
[source, json]
----
bigquery.jobs.get
bigquery.jobs.list
bigquery.jobs.listAll
bigquery.datasets.create
bigquery.datasets.get
bigquery.jobs.create
bigquery.tables.get
bigquery.tables.getData
bigquery.tables.list
bigquery.tables.create
----
. Selezionare *Aggiorna* per salvare il ruolo modificato.




== Verificare i requisiti della licenza

* Prima di poter attivare NetApp Backup and Recovery per il tuo cluster, dovrai abbonarti a un'offerta Console Marketplace pay-as-you-go (PAYGO) di Google oppure acquistare e attivare una licenza BYOL di NetApp Backup and Recovery da NetApp.  Queste licenze sono riservate al tuo account e possono essere utilizzate su più sistemi.
+
** Per la licenza NetApp Backup and Recovery PAYGO, è necessario un abbonamento a https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project["Offerta NetApp Console da Google Marketplace"^] .  La fatturazione per NetApp Backup and Recovery avviene tramite questo abbonamento.
** Per la licenza BYOL NetApp Backup and Recovery, avrai bisogno del numero di serie di NetApp che ti consentirà di utilizzare il servizio per la durata e la capacità della licenza. link:br-start-licensing.html["Scopri come gestire le tue licenze BYOL"] .


* È necessario disporre di un abbonamento Google per lo spazio di archiviazione degli oggetti in cui verranno salvati i backup.


*Regioni supportate*

È possibile creare backup dai sistemi locali su Google Cloud Storage in tutte le regioni.  Quando si configura il servizio, è possibile specificare la regione in cui verranno archiviati i backup.



== Prepara i tuoi cluster ONTAP

Sarà necessario preparare il sistema ONTAP locale di origine e tutti i sistemi ONTAP locali secondari o Cloud Volumes ONTAP .

La preparazione dei cluster ONTAP prevede i seguenti passaggi:

* Scopri i tuoi sistemi ONTAP nella console NetApp
* Verificare i requisiti di sistema ONTAP
* Verificare i requisiti di rete ONTAP per il backup dei dati su storage di oggetti
* Verificare i requisiti di rete ONTAP per la replica dei volumi




=== Scopri i tuoi sistemi ONTAP nella console NetApp

Sia il sistema ONTAP locale di origine che eventuali sistemi ONTAP locali secondari o Cloud Volumes ONTAP devono essere disponibili nella pagina *Sistemi* della console NetApp .

Per aggiungere il cluster, è necessario conoscere l'indirizzo IP di gestione del cluster e la password dell'account utente amministratore. https://docs.netapp.com/us-en/storage-management-ontap-onprem/task-discovering-ontap.html["Scopri come scoprire un cluster"^] .



=== Verificare i requisiti di sistema ONTAP

Assicurarsi che siano soddisfatti i seguenti requisiti ONTAP :

* Minimo ONTAP 9.8; si consiglia ONTAP 9.8P13 e versioni successive.
* Una licenza SnapMirror (inclusa come parte del Premium Bundle o del Data Protection Bundle).
+
*Nota:* il "Hybrid Cloud Bundle" non è richiesto quando si utilizza NetApp Backup and Recovery.

+
Impara come https://docs.netapp.com/us-en/ontap/system-admin/manage-licenses-concept.html["gestisci le licenze del tuo cluster"^] .

* L'ora e il fuso orario sono impostati correttamente.  Impara come https://docs.netapp.com/us-en/ontap/system-admin/manage-cluster-time-concept.html["configura l'ora del tuo cluster"^] .
* Se si intende replicare i dati, è necessario verificare che i sistemi di origine e di destinazione eseguano versioni ONTAP compatibili prima di replicare i dati.
+
https://docs.netapp.com/us-en/ontap/data-protection/compatible-ontap-versions-snapmirror-concept.html["Visualizza le versioni ONTAP compatibili per le relazioni SnapMirror"^] .





=== Verificare i requisiti di rete ONTAP per il backup dei dati su storage di oggetti

È necessario configurare i seguenti requisiti sul sistema che si connette all'archiviazione di oggetti.

* Per un'architettura di backup fan-out, configurare le seguenti impostazioni sul sistema _primario_.
* Per un'architettura di backup a cascata, configurare le seguenti impostazioni sul sistema _secondario_.


Sono necessari i seguenti requisiti di rete del cluster ONTAP :

* Il cluster ONTAP avvia una connessione HTTPS sulla porta 443 dal LIF intercluster a Google Cloud Storage per le operazioni di backup e ripristino.
+
ONTAP legge e scrive dati da e verso l'archiviazione di oggetti. L'archiviazione degli oggetti non si avvia mai, risponde e basta.

* ONTAP richiede una connessione in ingresso dall'agente della console al LIF di gestione del cluster.  L'agente della console può risiedere in una VPC di Google Cloud Platform.
* È necessario un LIF intercluster su ciascun nodo ONTAP che ospita i volumi di cui si desidera eseguire il backup.  Il LIF deve essere associato allo _IPspace_ che ONTAP deve utilizzare per connettersi all'archiviazione degli oggetti. https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["Scopri di più su IPspaces"^] .
+
Quando si configura NetApp Backup and Recovery, viene richiesto di specificare lo spazio IP da utilizzare. Dovresti scegliere lo spazio IP a cui è associato ciascun LIF. Potrebbe trattarsi dello spazio IP "predefinito" o di uno spazio IP personalizzato creato da te.

* I LIF intercluster dei nodi sono in grado di accedere all'archivio oggetti.
* I server DNS sono stati configurati per la VM di archiviazione in cui si trovano i volumi.  Scopri come https://docs.netapp.com/us-en/ontap/networking/configure_dns_services_auto.html["configurare i servizi DNS per l'SVM"^] .
+
Se utilizzi Private Google Access o Private Service Connect, assicurati che i tuoi server DNS siano stati configurati per puntare `storage.googleapis.com` all'indirizzo IP interno (privato) corretto.

* Tieni presente che se utilizzi uno spazio IP diverso da quello predefinito, potrebbe essere necessario creare una route statica per accedere all'archiviazione degli oggetti.
* Se necessario, aggiornare le regole del firewall per consentire le connessioni di NetApp Backup and Recovery da ONTAP all'archiviazione degli oggetti tramite la porta 443 e il traffico di risoluzione dei nomi dalla VM di archiviazione al server DNS tramite la porta 53 (TCP/UDP).




=== Verificare i requisiti di rete ONTAP per la replica dei volumi

Se si prevede di creare volumi replicati su un sistema ONTAP secondario utilizzando NetApp Backup and Recovery, assicurarsi che i sistemi di origine e di destinazione soddisfino i seguenti requisiti di rete.



==== Requisiti di rete ONTAP in sede

* Se il cluster si trova nei tuoi locali, dovresti disporre di una connessione dalla tua rete aziendale alla tua rete virtuale nel provider cloud.  In genere si tratta di una connessione VPN.
* I cluster ONTAP devono soddisfare requisiti aggiuntivi relativi a subnet, porte, firewall e cluster.
+
Poiché è possibile replicare su Cloud Volumes ONTAP o su sistemi locali, esaminare i requisiti di peering per i sistemi ONTAP locali. https://docs.netapp.com/us-en/ontap-sm-classic/peering/reference_prerequisites_for_cluster_peering.html["Visualizza i prerequisiti per il peering dei cluster nella documentazione ONTAP"^] .





==== Requisiti di rete Cloud Volumes ONTAP

* Il gruppo di sicurezza dell'istanza deve includere le regole in entrata e in uscita richieste: in particolare, le regole per ICMP e le porte 11104 e 11105.  Queste regole sono incluse nel gruppo di sicurezza predefinito.




== Prepara Google Cloud Storage come destinazione di backup

Per preparare Google Cloud Storage come destinazione di backup, sono necessari i seguenti passaggi:

* Imposta le autorizzazioni.
* (Facoltativo) Crea i tuoi bucket.  (Se lo desideri, il servizio creerà dei bucket per te.)
* (Facoltativo) Impostare le chiavi gestite dal cliente per la crittografia dei dati




=== Imposta i permessi

È necessario fornire le chiavi di accesso all'archiviazione per un account di servizio che dispone di autorizzazioni specifiche utilizzando un ruolo personalizzato.  Un account di servizio consente a NetApp Backup and Recovery di autenticare e accedere ai bucket di Cloud Storage utilizzati per archiviare i backup. Le chiavi sono necessarie affinché Google Cloud Storage sappia chi sta effettuando la richiesta.

.Passi
. Nel https://console.cloud.google.com["Google Cloud Console"^] , vai alla pagina *Ruoli*.
. https://cloud.google.com/iam/docs/creating-custom-roles#creating_a_custom_role["Crea un nuovo ruolo"^]con le seguenti autorizzazioni:
+
[source, json]
----
storage.buckets.create
storage.buckets.delete
storage.buckets.get
storage.buckets.list
storage.buckets.update
storage.buckets.getIamPolicy
storage.multipartUploads.create
storage.objects.create
storage.objects.delete
storage.objects.get
storage.objects.list
storage.objects.update
----
. Nella console di Google Cloud, https://console.cloud.google.com/iam-admin/serviceaccounts["vai alla pagina Account di servizio"^] .
. Seleziona il tuo progetto Cloud.
. Seleziona *Crea account di servizio* e fornisci le informazioni richieste:
+
.. *Dettagli dell'account di servizio*: inserisci un nome e una descrizione.
.. *Concedi a questo account di servizio l'accesso al progetto*: seleziona il ruolo personalizzato appena creato.
.. Selezionare *Fatto*.


. Vai a https://console.cloud.google.com/storage/settings["Impostazioni di archiviazione GCP"^] e creare chiavi di accesso per l'account di servizio:
+
.. Seleziona un progetto e seleziona *Interoperabilità*. Se non lo hai già fatto, seleziona *Abilita accesso interoperabilità*.
.. In *Chiavi di accesso per gli account di servizio*, seleziona *Crea una chiave per un account di servizio*, seleziona l'account di servizio appena creato e fai clic su *Crea chiave*.
+
Sarà necessario immettere le chiavi in ​​NetApp Backup and Recovery in un secondo momento, quando si configura il servizio di backup.







=== Crea i tuoi bucket

Per impostazione predefinita, il servizio crea dei bucket per te.  In alternativa, se si desidera utilizzare i propri bucket, è possibile crearli prima di avviare la procedura guidata di attivazione del backup e quindi selezionare tali bucket nella procedura guidata.

link:prev-ontap-protect-journey.html["Scopri di più sulla creazione dei tuoi bucket"^] .



=== Impostare le chiavi di crittografia gestite dal cliente (CMEK) per la crittografia dei dati

Puoi utilizzare le tue chiavi gestite dal cliente per la crittografia dei dati anziché le chiavi di crittografia predefinite gestite da Google.  Sono supportate sia le chiavi interregionali che quelle interprogetto, quindi è possibile scegliere un progetto per un bucket diverso dal progetto della chiave CMEK.

Se intendi utilizzare le tue chiavi gestite dal cliente:

* Per poter aggiungere queste informazioni nella procedura guidata di attivazione, è necessario disporre del Key Ring e del Key Name. https://cloud.google.com/kms/docs/cmek["Scopri di più sulle chiavi di crittografia gestite dal cliente"^] .
* Sarà necessario verificare che le seguenti autorizzazioni richieste siano incluse nel ruolo dell'agente della console:
+
[source, json]
----
cloudkms.cryptoKeys.get
cloudkms.cryptoKeys.getIamPolicy
cloudkms.cryptoKeys.list
cloudkms.cryptoKeys.setIamPolicy
cloudkms.keyRings.get
cloudkms.keyRings.getIamPolicy
cloudkms.keyRings.list
cloudkms.keyRings.setIamPolicy
----
* Dovrai verificare che l'API "Cloud Key Management Service (KMS)" di Google sia abilitata nel tuo progetto. Vedi il https://cloud.google.com/apis/docs/getting-started#enabling_apis["Documentazione di Google Cloud: abilitazione delle API"^] per i dettagli.


*Considerazioni CMEK:*

* Sono supportate sia le chiavi HSM (supportate da hardware) sia quelle generate da software.
* Sono supportate sia le chiavi Cloud KMS appena create che quelle importate.
* Sono supportate solo le chiavi regionali, le chiavi globali non sono supportate.
* Attualmente è supportata solo la funzione "Crittografia/decifratura simmetrica".
* All'agente di servizio associato all'account di archiviazione viene assegnato il ruolo IAM "CryptoKey Encrypter/Decrypter (roles/cloudkms.cryptoKeyEncrypterDecrypter)" da NetApp Backup and Recovery.




== Attiva i backup sui tuoi volumi ONTAP

Attiva i backup in qualsiasi momento direttamente dal tuo sistema locale.

Una procedura guidata ti guiderà attraverso i seguenti passaggi principali:

* <<Seleziona i volumi di cui vuoi eseguire il backup>>
* <<Definire la strategia di backup>>
* <<Rivedi le tue selezioni>>


Puoi anche<<Mostra i comandi API>> nella fase di revisione, in modo da poter copiare il codice per automatizzare l'attivazione del backup per i sistemi futuri.



=== Avvia la procedura guidata

.Passi
. Accedere alla procedura guidata di attivazione del backup e del ripristino utilizzando uno dei seguenti metodi:
+
** Dalla pagina *Sistemi* della console, selezionare il sistema e selezionare *Abilita > Volumi di backup* accanto a Backup e ripristino nel pannello di destra.
+
Se la destinazione di Google Cloud Storage per i backup è presente nella pagina *Sistemi* della console, è possibile trascinare il cluster ONTAP nell'archivio oggetti di Google Cloud.

** Selezionare *Volumi* nella barra Backup e ripristino.  Dalla scheda Volumi, seleziona *Azioni*image:icon-action.png["Icona Azioni"] icona e seleziona *Attiva backup* per un singolo volume (che non abbia già abilitato la replica o il backup su storage di oggetti).


+
La pagina Introduzione della procedura guidata mostra le opzioni di protezione, tra cui snapshot locali, replica e backup.  Se in questo passaggio è stata scelta la seconda opzione, verrà visualizzata la pagina Definisci strategia di backup con un volume selezionato.

. Proseguire con le seguenti opzioni:
+
** Se hai già un agente Console, sei a posto.  Basta selezionare *Avanti*.
** Se non si dispone già di un agente Console, viene visualizzata l'opzione *Aggiungi un agente Console*. Fare riferimento a <<Prepara il tuo agente Console>> .






=== Seleziona i volumi di cui vuoi eseguire il backup

Seleziona i volumi che vuoi proteggere.  Un volume protetto è un volume che presenta una o più delle seguenti caratteristiche: criterio di snapshot, criterio di replica, criterio di backup su oggetto.

È possibile scegliere di proteggere i volumi FlexVol o FlexGroup ; tuttavia, non è possibile selezionare una combinazione di questi volumi quando si attiva il backup per un sistema.  Scopri comelink:prev-ontap-backup-manage.html["attiva il backup per volumi aggiuntivi nel sistema"] (FlexVol o FlexGroup) dopo aver configurato il backup per i volumi iniziali.

[NOTE]
====
* È possibile attivare un backup solo su un singolo volume FlexGroup alla volta.
* I volumi selezionati devono avere la stessa impostazione SnapLock .  Tutti i volumi devono avere SnapLock Enterprise abilitato o SnapLock disabilitato.


====
.Passi
Se ai volumi scelti sono già applicati criteri di snapshot o replica, i criteri selezionati in seguito sovrascriveranno quelli esistenti.

. Nella pagina Seleziona volumi, seleziona il volume o i volumi che desideri proteggere.
+
** Facoltativamente, filtra le righe per visualizzare solo i volumi con determinati tipi di volume, stili e altro ancora, per semplificare la selezione.
** Dopo aver selezionato il primo volume, è possibile selezionare tutti i volumi FlexVol (i volumi FlexGroup possono essere selezionati solo uno alla volta).  Per eseguire il backup di tutti i volumi FlexVol esistenti, selezionare prima un volume e poi la casella nella riga del titolo.
** Per eseguire il backup di singoli volumi, selezionare la casella per ciascun volume.


. Selezionare *Avanti*.




=== Definire la strategia di backup

Per definire la strategia di backup è necessario impostare le seguenti opzioni:

* Se desideri una o tutte le opzioni di backup: snapshot locali, replica e backup su storage di oggetti
* Architettura
* Criterio di snapshot locale
* Destinazione e politica di replicazione
+

NOTE: Se i volumi scelti hanno policy di snapshot e replica diverse da quelle selezionate in questo passaggio, le policy esistenti verranno sovrascritte.

* Backup delle informazioni di archiviazione degli oggetti (provider, crittografia, rete, criteri di backup e opzioni di esportazione).


.Passi
. Nella pagina Definisci strategia di backup, seleziona una o tutte le seguenti opzioni.  Per impostazione predefinita, sono selezionate tutte e tre:
+
** *Snapshot locali*: se si esegue la replica o il backup su un archivio di oggetti, è necessario creare snapshot locali.
** *Replica*: crea volumi replicati su un altro sistema di archiviazione ONTAP .
** *Backup*: esegue il backup dei volumi nell'archiviazione degli oggetti.


. *Architettura*: Se hai scelto la replica e il backup, seleziona uno dei seguenti flussi di informazioni:
+
** *A cascata*: le informazioni fluiscono dal primario al secondario e dal secondario all'archiviazione degli oggetti.
** *Distribuzione a ventaglio*: le informazioni fluiscono dal primario al secondario _e_ dal primario all'archiviazione degli oggetti.
+
Per i dettagli su queste architetture, fare riferimento alink:prev-ontap-protect-journey.html["Pianifica il tuo percorso di protezione"] .



. *Snapshot locale*: scegli un criterio di snapshot esistente o creane uno nuovo.
+

TIP: Per creare una policy personalizzata, fare riferimento alink:br-use-policies-create.html["Crea una politica"] .

+
Per creare una policy, seleziona *Crea nuova policy* e procedi come segue:

+
** Inserisci il nome della policy.
** Selezionare fino a cinque pianificazioni, in genere con frequenze diverse.
** Seleziona *Crea*.


. *Replica*: Imposta le seguenti opzioni:
+
** *Destinazione di replica*: selezionare il sistema di destinazione e l'SVM.  Facoltativamente, selezionare l'aggregato o gli aggregati di destinazione e il prefisso o il suffisso che verranno aggiunti al nome del volume replicato.
** *Criterio di replicazione*: scegli un criterio di replicazione esistente o creane uno nuovo.
+

TIP: Per creare una policy personalizzata, fare riferimento alink:br-use-policies-create.html["Crea una politica"] .

+
Per creare una policy, seleziona *Crea nuova policy* e procedi come segue:

+
*** Inserisci il nome della policy.
*** Selezionare fino a cinque pianificazioni, in genere con frequenze diverse.
*** Seleziona *Crea*.




. *Backup su oggetto*: se hai selezionato *Backup*, imposta le seguenti opzioni:
+
** *Provider*: seleziona *Google Cloud*.
** *Impostazioni del provider*: immettere i dettagli del provider e la regione in cui verranno archiviati i backup.
+
Crea un nuovo bucket oppure selezionane uno già creato.

+

TIP: Se desideri suddividere i file di backup più vecchi nell'archiviazione di Google Cloud Archive per un'ulteriore ottimizzazione dei costi, assicurati che il bucket disponga della regola del ciclo di vita appropriata.

+
Inserisci la chiave di accesso e la chiave segreta di Google Cloud.

** *Chiave di crittografia*: se hai creato un nuovo account di archiviazione Google Cloud, inserisci le informazioni sulla chiave di crittografia fornite dal provider.  Scegli se utilizzare le chiavi di crittografia predefinite di Google Cloud oppure scegliere le chiavi gestite dal cliente dal tuo account Google Cloud per gestire la crittografia dei tuoi dati.
+

NOTE: Se hai scelto un account di archiviazione Google Cloud esistente, le informazioni sulla crittografia sono già disponibili, quindi non è necessario inserirle ora.

+
Se scegli di utilizzare le tue chiavi gestite dal cliente, inserisci il portachiavi e il nome della chiave. https://cloud.google.com/kms/docs/cmek["Scopri di più sulle chiavi di crittografia gestite dal cliente"^] .

** *Networking*: Seleziona lo spazio IP.
+
Lo spazio IP nel cluster ONTAP in cui risiedono i volumi di cui si desidera eseguire il backup.  I LIF intercluster per questo spazio IP devono avere accesso a Internet in uscita.

** *Criterio di backup*: seleziona un criterio di backup esistente per l'archiviazione degli oggetti oppure creane uno nuovo.
+

TIP: Per creare una policy personalizzata, fare riferimento alink:br-use-policies-create.html["Crea una politica"] .

+
Per creare una policy, seleziona *Crea nuova policy* e procedi come segue:

+
*** Inserisci il nome della policy.
*** Selezionare fino a cinque pianificazioni, in genere con frequenze diverse.
*** Seleziona *Crea*.


** *Esporta copie snapshot esistenti nell'archivio oggetti come copie di backup*: se sono presenti copie snapshot locali per i volumi in questo sistema che corrispondono all'etichetta di pianificazione del backup appena selezionata per questo sistema (ad esempio, giornaliera, settimanale, ecc.), viene visualizzato questo prompt aggiuntivo.  Seleziona questa casella per copiare tutti gli snapshot storici nell'archivio oggetti come file di backup, per garantire la protezione più completa per i tuoi volumi.


. Selezionare *Avanti*.




=== Rivedi le tue selezioni

Questa è l'occasione per rivedere le tue selezioni e apportare modifiche, se necessario.

.Passi
. Nella pagina Revisione, rivedi le tue selezioni.
. Facoltativamente, seleziona la casella per *Sincronizzare automaticamente le etichette dei criteri Snapshot con le etichette dei criteri di replica e backup*.  In questo modo vengono creati snapshot con un'etichetta che corrisponde alle etichette nei criteri di replica e backup.
. Seleziona *Attiva backup*.


.Risultato
NetApp Backup and Recovery inizia a eseguire i backup iniziali dei volumi.  Il trasferimento di base del volume replicato e del file di backup include una copia completa dei dati del sistema di archiviazione primario.  I trasferimenti successivi contengono copie differenziali dei dati del sistema di archiviazione primario contenuti nelle copie Snapshot.

Nel cluster di destinazione viene creato un volume replicato che verrà sincronizzato con il volume di origine.

Un bucket di Google Cloud Storage viene creato automaticamente nell'account di servizio indicato dalla chiave di accesso e dalla chiave segreta di Google immesse, e i file di backup vengono archiviati lì.  Viene visualizzata la dashboard di backup del volume, in modo da poter monitorare lo stato dei backup.

È inoltre possibile monitorare lo stato dei processi di backup e ripristino utilizzandolink:br-use-monitor-tasks.html["Pagina di monitoraggio dei lavori"^] .



=== Mostra i comandi API

Potrebbe essere necessario visualizzare e, facoltativamente, copiare i comandi API utilizzati nella procedura guidata Attiva backup e ripristino.  Potresti voler fare questo per automatizzare l'attivazione del backup nei sistemi futuri.

.Passi
. Dalla procedura guidata Attiva backup e ripristino, seleziona *Visualizza richiesta API*.
. Per copiare i comandi negli appunti, selezionare l'icona *Copia*.

